<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Http front controller.
 *
 * PHP Version 5
 *
 * @category   Ding
 * @package    Mvc
 * @subpackage Http
 * @author     Marcelo Gornstein &lt;marcelog@gmail.com&gt;
 * @license    http://marcelog.github.com/ Apache License 2.0
 * @link       http://marcelog.github.com/
 *
 * Copyright 2011 Marcelo Gornstein &lt;marcelog@gmail.com&gt;
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
namespace Ding\Mvc\Http;

use Ding\Mvc\IViewRender;
use Ding\HttpSession\HttpSession;
use Ding\Mvc\IMapper;
use Ding\Mvc\Exception\MvcException;
use Ding\Mvc\ModelAndView;
use Ding\Mvc\RedirectModelAndView;
use Ding\Mvc\ForwardModelAndView;
use Ding\Container\Impl\ContainerImpl;

/**
 * Http front controller.
 *
 * PHP Version 5
 *
 * @category   Ding
 * @package    Mvc
 * @subpackage Http
 * @author     Marcelo Gornstein &lt;marcelog@gmail.com&gt;
 * @license    http://marcelog.github.com/ Apache License 2.0
 * @link       http://marcelog.github.com/
 */
class HttpFrontController
{
    /**
     * Log4PHP Logger or own dummy implementation.
     * @var Logger
     */
    private static $_logger;

    public static function dispatch(
        HttpDispatcher $dispatcher,
        HttpViewResolver $viewResolver,
        HttpAction $action,
        IMapper $mapper,
        IViewRender $render
    ) {
        $modelAndView = $dispatcher-&gt;dispatch($action, $mapper);
        if ($modelAndView instanceof ForwardModelAndView) {
            self::$_logger-&gt;debug(
              	'Forwarding ModelAndView: ' . $modelAndView-&gt;getName()
            );
            $newAction = new HttpAction($modelAndView-&gt;getName(), $modelAndView-&gt;getModel());
            $newAction-&gt;getMethod($action-&gt;getMethod());
            self::dispatch($dispatcher, $viewResolver, $newAction, $mapper, $render);
        } else if ($modelAndView instanceof RedirectModelAndView) {
            header('HTTP/1.1 302 Moved');
            $location = $modelAndView-&gt;getName();
            if (!$modelAndView-&gt;isEmpty()) {
                $location .= '?' . http_build_query($modelAndView-&gt;getModel());
            }
            header('Location: ' . $location);
            self::$_logger-&gt;debug(
               	'Redirecting ModelAndView: ' . $modelAndView-&gt;getName()
                . &quot; -&gt; $location&quot;
            );
        } else if ($modelAndView instanceof ModelAndView) {
            self::$_logger-&gt;debug(
               	'Using ModelAndView: ' . $modelAndView-&gt;getName()
            );
            $view = $viewResolver-&gt;resolve($modelAndView);
            $render-&gt;render($view);
        }
    }
    /**
     * Handles the request. This will instantiate the container with the given
     * properties (via static method configure(), see below). Then it will
     * getBean(HttpDispatcher) and call dispatch() on it with an Action created
     * based on the request uri and method parameters (get, post, etc).
     *
     * @return void
     */
    public static function handle(array $properties = array(), $baseUrl = '/')
    {
        $session = HttpSession::getSession();
        $container = ContainerImpl::getInstance($properties);
        self::$_logger = \Logger::getLogger(__CLASS__);
        $baseUrlLen = strlen($baseUrl);
        ob_start();
        $exceptionMapper = $render = $dispatcher = $viewResolver = false;
        try
        {
            $dispatcher = $container-&gt;getBean('HttpDispatcher');
            $viewResolver = $container-&gt;getBean('HttpViewResolver');
            $exceptionMapper = $container-&gt;getBean('HttpExceptionMapper');
            $render = $container-&gt;getBean('HttpViewRender');
            $method = strtolower($_SERVER['REQUEST_METHOD']);
            $url = $_SERVER['REQUEST_URI'];
            $urlStart = strpos($url, $baseUrl);

            self::$_logger-&gt;debug('Trying to match: ' . $url);
            if ($urlStart === false || $urlStart &gt; 0) {
                throw new MvcException($url . ' is not a base url.');
            }
            $url = substr($url, $baseUrlLen);
            $variables = array();
            if (!empty($_GET)) {
                $variables = array_merge($variables, $_GET);
            }
            if (!empty($_POST)) {
                $variables = array_merge($variables, $_POST);
            }
            $action = new HttpAction($url, $variables);
            $action-&gt;setMethod($method);
            $mapper = $container-&gt;getBean('HttpUrlMapper');
            self::dispatch($dispatcher, $viewResolver, $action, $mapper, $render);
        } catch(\Exception $exception) {
            self::$_logger-&gt;debug('Got Exception: ' . $exception);
            ob_end_clean();
            ob_start();
            if ($exceptionMapper === false) {
                header('HTTP/1.1 500 Error.');
            } else {
                $action = new HttpAction(
                    get_class($exception), array('exception' =&gt; $exception)
                );
                self::dispatch($dispatcher, $viewResolver, $action, $exceptionMapper, $render);
            }
        }
        ob_end_flush();
    }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>