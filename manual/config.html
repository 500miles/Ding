<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Ding: Configuring the container</title>
	
	<style type="text/css">
		body {
  		margin-top: 1.0em;
  		background-color: #f49648;
		  font-family: "Helvetica,Arial,FreeSans";
  		color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
		h1 { font-size: 3.8em; color: #0b69b7; margin-bottom: 3px; }
		h1 .small { font-size: 0.4em; }
		h1 a { text-decoration: none }
		h2 { font-size: 1.5em; color: #0b69b7; }
    h3 { color: #0b69b7; }
    a { color: #0b69b7; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
		pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
	</style>
	
</head>

<body>

<H1><u>Configuring the container</u></H1>
The container::getInstance() method accepts an array that is used configure the
framework. <br/>
<p>
$a = ContainerImpl::getInstance($properties);
</p>
<H2>Logging</H2>
Use the optional property: $properties['ding']['log4php.properties'] => './log4php.properties'

<H2>Bean Factory Drivers</H2>
You may configure any of the bean definition drivers available:
<ul>
  <li>xml: Parses the given xml file, usually beans.xml and get bean definitions from there. Requires the optional property 'filename'.</li>
  <li>annotation: Extracts bean definitions and other information right from the annotated code. Requires the property 'scanDir'.</li>
</ul>
These drivers are configured with their own properties:
<p>
<ul>
  <li>$properties['ding']['factory']['bdef']['xml']</li>
  <li>$properties['ding']['factory']['bdef']['annotation']</li>
</ul>
</p>
Example:
<p>
$properties['ding']['factory']['bdef']['xml'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'filename' => 'beans.xml'<br/>
)<br/>
</p>
<hr/>
<p>
$properties['ding']['factory']['bdef']['annotation'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'scanDir' => array(realpath(__DIR__))<br/>
)<br/>
</p>
<hr/>
<H2>User properties</H2>
Use the optional property: $properties['ding']['factory']['properties'] to
specify any key/value pair that you may want search and replace via the PropertyFilter. Example:
<p>
&lt;beans&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean id="beanName" class="A\B\C" scope="prototype"&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property name="someProperty"&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;${some.value}&lt;/value&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/property&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;<br/>
&lt;/beans&gt;<br/>
</p>
<p>
$properties['ding']['factory']['properties'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'some.value' => 'This is the final property value'<br/>
)<br/>
</p>

<H2>Cache Subsystems</H2>
The cache subsystems use $properties['ding']['cache']. The subsystems are:

<ul>
  <li><u>proxy</u>: To cache proxy definitions: its expensive to create proxies
  because php lacks this hability, so we have to actually generate code. This code
  can be cached.</li>
  <li><u>annotations</u>: To cache annotations, its *really* expensive if you have
  a large source tree or use them a lot. So we cache the annotations for each class and
  the files and directories scanned (along with all autodiscovered classes there).</li>
  <li><u>bdef</u>: To cache BeanDefinitions so no xml's or annotations have to be
  reparsed per every request.</li>
  <li><u>beans</u>: To cache the beans themselves. This is actually not so easy as it
  sounds, so dont expect it to work as intended. Note: this is not a flaw of Ding itself but
  inherent to the architecture used generally in php, the lack of the concept of an
  application server, etc. It is recomended to use the dummy implementation for this cache.</li>
</ul>
<p>
The resulting properties needed to configure each one of the cache subsystems:
</p>

<p>
<ul>
  <li>$properties['ding']['cache']['proxy']</li>
  <li>$properties['ding']['cache']['bdef']</li>
  <li>$properties['ding']['cache']['beans']</li>
  <li>$properties['ding']['cache']['annotations']</li>
</ul>
</p>
<p>
In turn, each one of these entries, require the 'impl' key to point to one
of the possible cache implementations:
<ul>
  <li><u>dummy</u>: Does not cache at all.</li>
  <li><u>file</u>: Uses the filesystem. Requires the additional option 'directory'.</li>
  <li><u>apc</u>: Uses apc.</li>
  <li><u>memcached</u>: Uses memcached php extension. Requires additional option 'memcached', an array with: 'host' and 'port'.</li>
  <li><u>zend</u>: Uses Zend_Cache. Requires additional option: 'zend' with an array of options of your choice according to Zend_Cache documentation.</li>
</ul>
</p>
<p>
Then, you can configure any of the cache subsystems with any of the cache implementations:<
</p>
<hr/>

<p>
$properties['ding']['cache']['proxy'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'impl' => 'file', 'directory' => '/tmp/Ding/cache'<br/>
)<br/>
</p>
<hr/>

<p>
$properties['ding']['cache']['bdef'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'impl' => 'memcached', 'memcached' => array('host' => '127.0.0.1', 'port' => 11211)<br/>
)<br/>
</p>

<p>
$properties['ding']['cache']['proxy'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'impl' => 'apc'<br/>
)<br/>
</p>
<hr/>

<p>
$properties['ding']['cache']['annotations'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'impl' => 'apc'<br/>
)<br/>
</p>
<hr/>

<p>
$properties['ding']['cache']['bdef'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'impl' => 'dummy'<br/>
)<br/>
</p>
<hr/>

<p>
$zendCacheOptions = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'frontend' => 'Core',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'backend' => 'File',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'backendoptions' => array('cache_dir' => '/tmp/Ding/zend/cache'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'frontendoptions' => array('lifetime' => 10000, 'automatic_serialization' => true)<br/>
);<br/>
<br/>
$properties['ding']['cache']['bdef'] = array(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'impl' => 'zend', 'zend' => $zendCacheOptions<br/>
)<br/>
</p>
<hr/>
<H2>Driver properties</H2>
<p>
Some drivers are optional:
<ul>
  <li>SignalHandler</li>
  <li>ErrorHandler</li>
  <li>Shutdown</li>
  <li>Timezone</li>
</ul>
You can explicitely tell the container to use them with the following options:<br/>
$options['drivers'] => array('signalhandler' => array())<br/><br/>
$options['drivers'] => array('errorhandler' => array())<br/><br/>
$options['drivers'] => array('shutdown' => array())<br/><br/>
$options['drivers'] => array('timezone' => array())<br/><br/>
</p>

</body>
</html>